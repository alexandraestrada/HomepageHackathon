<head>
	<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.2.6/interact.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script type="text/javascript" src="./js/main.js"></script>
	<script type="text/javascript" src="./js/dragndrop.js"></script>
	<script type="text/javascript" src="./js/export.js"></script>
	<link rel="stylesheet" type="text/css" href="./css/main.css"/>
	<link rel="stylesheet" type="text/css" href="./css/sidebar.css"/>
	<link rel="stylesheet" type="text/css" href="./css/imgDiv.css"/>
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css"/>
</head>
<body>
	<div id="mainDiv">
		<div id="imgDiv">
			<!-- <div id="fileDiv"><form id="dzForm" class="dropzone" action="/upload" method="post"></form></div> -->
			<ul id="imgList">
				<li><img src="./images/C6030042_01.png" /></li>
				<li><img src="./images/C6030042_02.png" /></li>
				<li><img src="./images/C6030042_03.jpg" /></li>
				<li><img src="./images/C6030042_04.jpg" /></li>
				<li><img src="./images/C6030042_05.gif" /></li>
				<li><img src="./images/C6030042_06.jpg" /></li>
				<li><img src="./images/C6030042_07.jpg" /></li>
				<li><img src="./images/C6030042_08.jpg" /></li>
				<li><img src="./images/C6030042_09.jpg" /></li>
				<li><img src="./images/C6030042_10.jpg" /></li>
				<li><img src="./images/C6030042_11.jpg" /></li>
				<li><img src="./images/C6030042_12.jpg" /></li>
				<li><img src="./images/C6030042_13.gif" /></li>
				<li><img src="./images/C6030042_14.gif" /></li>
				<li><img src="./images/C6030042_15.png" /></li>
				<li><img src="./images/C6030042_16.jpg" /></li>
				<li><img src="./images/C6030042_17.jpg" /></li>
				<li><img src="./images/C6030042_18.jpg" /></li>
				<li><img src="./images/C6030042_19.jpg" /></li>
				<li><img src="./images/C6030042_20.jpg" /></li>
				<li><img src="./images/C6030042_21.jpg" /></li>
				<li><img src="./images/C6030042_22.png" /></li>
				<li><img src="./images/C6030042_23.jpg" /></li>
				<li><img src="./images/C6030042_24.jpg" /></li>
				<li><img src="./images/C6030042_25.jpg" /></li>
				<li><img src="./images/C6030042_26.png" /></li>
			</ul>
		<!-- <ul>
			<li class="draggable"><img src="./images/C6030042_01.png" /><div id="overlay">960 X 60</div></li>
			<li class="draggable"><img src="./images/C6030042_06.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_07.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_08.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_06.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_07.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_08.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_06.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_07.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_08.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_09.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_10.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
			<li class="draggable"><img src="./images/C6030042_11.jpg" /><div id="overlay"><span>320 X 250</span></div></li>
		</ul> -->
		</div>
		<div id="contentDiv" class="area">

				<div id="layoutDiv">
					<ul id="imgMainList">
					</ul>
				</div>

			<div id="infoDiv">
				Specify the alt text for this image: <input id="altInput" type="text"/>
			</div>
		</div>
		<nav id="rightNav" class="main-menu">
		    <ul>
		        <li><a href="#">
		            <i class="fa fa-home fa-2x"></i>
		            <span class="nav-text">Dashboard</span>
		        </a></li>
		        <li class="has-subnav"><a href="#">
		            <i class="fa fa-laptop fa-2x"></i>
		            <span class="nav-text">UI Components</span>
		        </a></li>
		        <li class="has-subnav"><a href="#">
		            <i class="fa fa-list fa-2x"></i>
		            <span class="nav-text">Forms</span>
		        </a></li>
		        <li class="has-subnav"><a href="#">
		            <i class="fa fa-folder-open fa-2x"></i>
		            <span class="nav-text">Pages</span>
		        </a></li>
		        <li><a href="#">
		            <i class="fa fa-bar-chart-o fa-2x"></i>
		            <span class="nav-text">Graphs and Statistics</span>
		        </a></li>
		        <li><a id="selection-mode" href="#">
		            <i class="fa fa-font fa-2x"></i>
		            <span class="nav-text">Select links</span>
		        </a></li>
		        <li><a href="#">
		            <i class="fa fa-table fa-2x"></i>
		            <span class="nav-text">Tables</span>
		        </a></li>
		        <li><a href="#">
		            <i class="fa fa-map-marker fa-2x"></i>
		            <span class="nav-text">Maps</span>
		        </a></li>
		        <li><a href="#">
		            <i class="fa fa-info fa-2x"></i>
		            <span class="nav-text">Documentation</span>
		        </a></li>
		    </ul>
		    <ul class="logout">
		        <li><a id="exportA" href="#">
		            <i class="fa fa-power-off fa-2x"></i>
		            <span class="nav-text">EXPORT THIS PAGE</span>
		        </a></li>
		    </ul>
		</nav>
	</div>
	<script type="text/javascript" src="./js/draw_rect.js"></script>

<style type="text/css">
	body { margin: 0; }
	#canvas {
		width: 100%;
		height: 100%;
		background-color: #f6f6f6;
		position: relative;
	}
	.rect {
		border: 3px dotted black;
		position: absolute;
		z-index: 10;
	}
</style>

<div id="canvas"></div>

<!-- <script type="text/javascript" charset="utf&#45;8" src="./js/interact.js"></script> -->

<script type="text/javascript">

var dragging = false;



document.addEventListener("keydown", KeyCheck);  //or however you are calling your method
function KeyCheck(event)
{
   var KeyID = event.keyCode;
   switch(KeyID)
   {
      case 8:
				// If delete key is pressed, remove last selection from page, and from Model
    var selection = document.querySelector('.rect:last-child')
				canvas.removeChild(selection);
				// remove mapping also
				delete mapping[selection.getAttribute('data-sel-id')];
				// console.log(mapping);
      break;
      case 46:
      alert("delete");
      break;
      default:
      break;
   }
}



function wrapWithInteract() {
	interact('.resize-drag')
		.draggable({
			onmove: dragMoveListener,
			onend: dragEndListener
		})
		.resizable({
			preserveAspectRatio: false,
			edges: { left: false, right: true, bottom: true, top: false }
		})
		.on('resizemove', function (event) {
			dragging = true;
			var target = event.target,
					x = (parseFloat(target.getAttribute('data-x')) || 0),
					y = (parseFloat(target.getAttribute('data-y')) || 0);

			// update the element's style
			target.style.width  = event.rect.width + 'px';
			target.style.height = event.rect.height + 'px';

			// translate when resizing from top or left edges
			x += event.deltaRect.left;
			y += event.deltaRect.top;

			target.style.webkitTransform = target.style.transform =
					'translate(' + x + 'px,' + y + 'px)';

			target.setAttribute('data-x', x);
			target.setAttribute('data-y', y);

			target.textContent = Math.round(event.rect.width) + 'Ã—' + Math.round(event.rect.height);
	});
}


function dragEndListener() {
	dragging = true;
}

function dragMoveListener (event) {
  var target = event.target,
      // keep the dragged position in the data-x/data-y attributes
      x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
      y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

  // translate the element
  target.style.webkitTransform =
  target.style.transform =
    'translate(' + x + 'px, ' + y + 'px)';

  // update the posiion attributes
  target.setAttribute('data-x', x);
  target.setAttribute('data-y', y);

}


// K - Selection id
// V - Image id
var mapping = new Object();

	var canvas = document.getElementById("layoutDiv"),
		mouse = {
			x: 0,
			y: 0,
			startX: 0,
			startY: 0
		},
		el = null;


	var sel_cnt = 0;
	canvas.onclick = function(e) {
	  console.log(e);
		if (dragging) {
			dragging = false;
			return;
		}

		if(el === null) {
			mouse.startX = mouse.x;
			mouse.startY = mouse.y;
			el = document.createElement("div");
			el.className = "rect resize-drag";
			el.style.top = mouse.y + "px";
			el.style.left = mouse.x + "px";
			el.setAttribute('data-sel-id', sel_cnt);

			// map this selection to the img
			mapping[sel_cnt] = event.target.getAttribute('data-id');

			sel_cnt += 1;

			canvas.appendChild(el);
			canvas.style.cursor = "crosshair";
		} else {
			el = null;
			canvas.style.cursor = "default";

			// add interact.js to it
		}

		wrapWithInteract();
	};

	canvas.onmousemove = function(e) {
		setMousePosition(e);
		if(el !== null) {
			el.style.width = Math.abs(mouse.x - mouse.startX) + "px";
			el.style.height = Math.abs(mouse.y - mouse.startY) + "px";
			el.style.top = (mouse.y - mouse.startY < 0) ? mouse.y + "px" : mouse.startY + "px";
			el.style.left = (mouse.x - mouse.startX < 0) ? mouse.x + "px" : mouse.startX + "px";
		}
	};

	function setMousePosition(e) {
		var ev = e || window.event;
		if (ev.pageX) {
			mouse.x = ev.pageX + window.pageXOffset;
			mouse.y = ev.pageY + window.pageYOffset;
		} else if (ev.clientX) {
			mouse.x = ev.clientX + document.body.scrollLeft;
			mouse.y = ev.clientY + document.body.scrollTop;
		}
		// subtract width
		mouse.x = mouse.x - $('#imgDiv').width();
		// console.log(ev);
	};

</script>


</body>
